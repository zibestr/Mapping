# Описание алгоритмов работы
## Уточняющая информация
```
У филиалов вузов одинаковый ИНН, но разный КПП (код причины постановки).
```
## Parsing нового списка вузов
1. Сбор организацией имеющих лицензию от Федеральной службы надзора в сфере образования и науки на осуществление высшего образования в РФ с [реестра Рособрнадзора](https://obrnadzor.gov.ru/gosudarstvennye-uslugi-i-funkczii/gosudarstvennye-uslugi/liczenzirovanie-obrazovatelnoj-deyatelnosti/svodnyj-reestr-liczenzij/)
2. Удаление научных институтов, школ, и тд из списка: 
 - основным критерием было наличие слово сочетания **"высшего образования"** в полном наименование учреждения.
3. Сбор юридических данных об организациях с помощью [API Dadata](https://dadata.ru/api/):
- Проверить организацию на существование;
- Собрать ИНН, ОГРН, КПП, юр. адрес, регион, федеральный округ организации;
- Сформировать 2 списка для ручной проверки:
    - список ликвидированных организаций (цель - найти новую или подтвердить ее ликвидацию)
    - список с неверными указанными ИНН или КПП (цель - отредактировать ИНН и КПП, чтобы организация пробивалась через API Dadata)
4. Проставить флаг "Филиал" - если в полном название есть слово филиал, то 1, иначе 0.
## Mapping вузов
1. Из старого списка выбрать названия только вузов:
- 1.1. Отобрать СПО с помощью регулярных выражений:
    - содержит ```училище|коллед|птк|пту| спо |поу|коледж|технику|технимук|клледж|техниккум|среднего профессионального|комплекс|профессиональное образовательное учреждение|гбпоу|техниккм|коллежд|техникуи|коллеж|училише|ккст|акст|крэ|калп|чтотиб|лптт|.+[эмстпхж][кт]$|.+[эмстпхж][кт] |спо|гуо|иркпо|атпа```
    - не содержит ```гимназия|лицей\W+| лицей|тест```
- 1.2. Отобрать школы с помощью регулярных выражений:
    - содержит ```школ|гимназ|лицей|сош|мбоу|оош| цо |мбоуцо|соо|интернат| сш|шкила|шко|гимн|лице|school|шк |госш|центр образования|амоу|моу|мауо|моау|мобу|мкоу|общеобразовательн|цод|маоу|средняя|образовательный комплекс|предуниверсарий|кадет|пансион|сш |цо | сог | ош| мош |ссш|сш№|сш |сш\d|среднее образовательное уч|предуниверситарий|дете|средн```
    - не содержит ```высшая школа|университет |институт|высш|училище|колледж|птк|пту| спо |коледж|техникум|среднего профессионального|академия| университет$|университета путей и сообщений```
- 1.3. Из старого списка убрать все отобранные школы и СПО и выбрать вузы с помощью регулярных выражений:
    - содержит ```университ|инстит|высш| во |фгбоуво|аново|академи|универитет|уеиверситет|консерватор|фгбоу во|алмазова| впо |\w*гу$|\w*у(\s|-|_|$|\(|\)|,)|(^|\s|\()м[а-я]|ранхигс|итмо|рэу|рудн|лэти|синерг|маи|спб.+|ргу|гуп|гуап|плехан|вшэ|юа|ую|станки|униврситет|рмат | рмат|^рмат$|нггти|гсха|дон[а-я]{2,}|универститет|универстет|унимерситет|дальрыбвтуз|пгути|букэп|сибгу|вгуит|согма|гу|уриверситет|унивеситет|г[а-я]а```
    - не содержит ```поу|колледж|техникум|училище| лицей|лицей |лицей-|коллеж|академическая школа|школа-интернат|школа 1534|гимна|учреждение науки| научный центр|предприятие|научно-исследовательский институт|научно-исследовательский геологический институт|школьн```
2. Вручную отредактировать список вузов:
    - отредактировать неформатные названия (старые наименования вузов, привезти максимальное количество; наименование к виду в новом списке)
    - удалить учреждения неявляющиеся вузами.
3. Выбрать список для удаления:
    - выбрать все учреждения, которые не попали в список вузов.
4. Дополнить названия вузов в новом списке:
- скопировать названия, которые содержат министерство и удалить его из этих названий;
- скопировать названия, которые содержат "российская федерация" и заменить на РФ;
- скопировать краткие названия, которые содержать "ФГБОУ ВО" и удалить это значения из выбранных названий;
- скопировать названия, которые содержат юридические наименования (федеральное, государственное и тд), и удалить их из них;
5. Нормализовать все названия вузов:
- Привести к нижнему регистру;
- Удалить из строки все символы, кроме букв и пробелов;
- Заменить 2 и более пробелов идущих подряд на 1 пробел.
6. Векторизовать названия вузов с помощью алгоритма [Bag of Words (BoW)](https://en.wikipedia.org/wiki/Bag-of-words_model).
7. Вычислить cosine similarity для каждой пары векторов из нового и старого списка по формуле:

    $cosine similarity(v_1, v_2) = \frac{v_1 v_2}{\lVert v_1 \rVert \lVert v_2 \rVert}$

8. Отобрать пары векторов, у которых cosine similarity >= 0.97.
9. Отобранные пары векторов добавить в таблицу для mapping'а, с указанием старого id вуза и id в новой базе.