# Mapping вузов платформы проекта "Твой Ход"
## Бизнес описание задачи
Для проекта "Твой Ход" собран новый список образовательных учреждений. Цель нового списка - очистить старый список от "ошибочных" вузов, средних учебных заведений, нецензурных наименований в базе проекта и тд.

Для замены старого списка на новый был проведен mapping - на основе алгоритмов нечеткого сравнения строк наименованиям из старого списка были сопоставлены наименования из нового списка.

На основе составленного mapping'а необходимо заменить старый список на новых, не нарушив связи между сущностями базы данных.
## Функциональное описание задачи
1. Сделать бэкап таблицы **образовательных учреждений** (на случай непредвиденных ошибок).
2. В таблице **образовательных учреждений** перезаписать кортежи из файла **mapping.csv** по следующему правилу:
    - если *первичный ключ* из **mapping.csv** уже есть в таблице **образовательных учреждений**, то перезаписать значения атрибутов для этого кортежа из **mapping.csv** (атрибуты, которые не указаны в **mapping.csv**, но есть в таблице **образовательных учреждений**, заполнить пустыми значениями);
    - если *первичного ключа* из **mapping.csv** нет в таблице **образовательных учреждений**, то добавить в таблицу кортеж со значениями из **mapping.csv** с выбранным *первичным ключом* (атрибуты, которые не указаны в **mapping.csv**, но есть в таблице **образовательных учреждений**, заполнить пустыми значениями);
3. В таблице *пользователей* заменить **внешний ключ на образовательное учреждение** на **новый внешний ключ** с помощью файла **mapping.csv** (если для старого внешнего ключа образовательного учреждения нет соответствия в новом списке, то поставить **пустое значение** вместо нового внешнего ключа).
4. В таблице *связи образовательного учреждения и владельца ЛК образовательного учреждения* заменить текущие **внешний ключ на образовательное учреждение** на **новые внешние ключи** с помощью файла **mapping.csv**.
5. Удалить из таблицы **образовательных учреждений** кортежи, *первичных ключей* которых нет в **mapping.csv**.
## Пояснительная записка
### new_db.csv
Новая таблица вузов для БД
#### Поля:
 - id - id учебного заведения
 - legal_inn - ИНН учебного заведения
 - legal_ogrn - ОГРН учебного заведения
 - legal_kpp - КПП (код причины поставновки) учебного заведения
 - name - Полное наименование учебного заведения 
 - short_name - Краткое наименование учебного заведения
 - legal_address - Юридический адрес учебного заведения
 - region - id региона учебного заведения
 - district_id - id федерального округа 
 - branch - флаг, является ли учебного заведение филиалом
### mapping.csv
Таблица с итоговым mapping'ом вузов платформы
#### Поля:
 - old_id - id учебного заведения из старой таблицы БД платформы
 - new_id - id учебного заведения из новой таблицы **new_db.csv**
### mapping_with_names.csv
Таблица с итоговым mapping'ом вузов платформы с указанием названий (таблица прикладывается для валидации работы алгоритма)
#### Поля:
 - old_id - id учебного заведения из старой таблицы БД платформы
 - new_id - id учебного заведения из новой таблицы **new_db.csv**
 - old_name - полное наименование учебного заведения из старой таблицы БД платформы
 - new_name - полное наименование учебного заведения из новой таблицы **new_db.csv**

Алгоритм составления список см. в [algorithms.md](algorithms.md)